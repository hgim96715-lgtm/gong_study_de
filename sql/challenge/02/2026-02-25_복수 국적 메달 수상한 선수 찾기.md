---
tags:
  - SQL_TEST
related:
  - "[[00_SQL_Challenge_DashBoard]]"
  - "[[SQL_DISTINCT_vs_GROUP_BY]]"
source: solvesql
difficulty:
  - Lv.3
status: 🟩 해결
---
##  해결 전략 (Code Before Think)

> 2000년 이후의 메달 수상 기록만 고려했을 때, 메달을 수상한 올림픽 참가 선수 중 2개 이상의 국적으로 메달을 수상한 기록이 있는 선수의 이름을 조회하는 쿼리를 작성해주세요. 조회된 선수의 이름은 오름차순으로 정렬되어 있어야 합니다.

1. **타겟 데이터:** (어떤 테이블에서 무엇을 뽑아야 하는가?)
   - `athletes` 테이블
	   - ` name` 선수 이름
	   - ` id` 선수 ID
   - `records` 테이블
	   - `athlete_id` 선수 ID
	   - `medal` 메달 (Gold/Silver/Bronze)
	   - `game_id` 출전 올림픽 게임 ID
	   - ` team_id` 팀 ID
   - `games` 테이블
	   - ` city` 개최도시
	   - `year` 개최연도
	   - `id` 올림픽 게임 ID
   - `teams` 테이블
	   - `id` 팀 ID
	   - `team` 팀 이름 (국가정보)
1. **조건 분석:**
   - 판단 기준은 무엇인가? → 선수(id)
   - 무엇의 종류를 세는가? → 국적(team)
1. **사용할 문법:**
   - 
---
## 정답 쿼리 (Solution)

```sql
-- 여기에 작성한 쿼리를 붙여넣으세요.
WITH medals AS (
    SELECT
        a.id,
        a.name,
        t.team,
        g.year,
        r.medal
    FROM athletes AS a
    JOIN records  AS r ON a.id = r.athlete_id
    JOIN games    AS g ON r.game_id = g.id
    JOIN teams    AS t ON r.team_id = t.id
    WHERE g.year >= 2000
      AND r.medal IS NOT NULL
)

SELECT
    name
FROM medals
GROUP BY
    id,
    name
HAVING COUNT(DISTINCT team) >= 2
ORDER BY
    name;
```

---
##  오답 노트 & 배운 점 (Retrospective)

-  **내가 실수한 부분:**
	- 처음에 `COUNT(team) >= 2` 로 조건을 걸어 **같은 국적으로 여러 번 메달을 딴 경우까지 포함되는 실수**를 함> 결과가 많이나옴
    
-  **새로 알게 된 함수/꿀팁:**
	- “몇 개 이상의 서로 다른 값”을 묻는 문제는 `{sql}HAVING COUNT(DISTINCT 컬럼) >= N`

---
## 더 나은 풀이가 있다면?

```sql
-- 더 나은 풀이가 있을경우 
```

---
tags:
  - SQL_TEST
related:
  - "[[00_SQL_Challenge_DashBoard]]"
  - "[[SQL_CASE_WHEN]]"
source: solvesql
difficulty:
  - Lv.2
status: 🟧 복습
---
##  해결 전략 (Code Before Think)

> 소장품 중 부분 기증품을 포함한 기증품의 비율이 얼마나 되는지 계산하는 쿼리를 작성해주세요. 
>  작품 정보 중 `credit` 컬럼에 'gift'라는 단어가 등장하는 작품은 MoMA가 다른 사람이나 단체로 부터 기증 받은 기증품이라는 뜻입니다.
> 기증품의 비율은 백분율로 계산되어야하고, 소수점 아래 넷째 자리에서 반올림 해 셋째 자리까지 표시 되어야 합니다

1. **타겟 데이터:** (어떤 테이블에서 무엇을 뽑아야 하는가?)
   - `artworks`테이블
   - ` credit` 소장경로
   - `artwork_id` 작품ID
1. **조건 분석:**
   - 
3. **사용할 문법:**
   - 
---
## 정답 쿼리 (Solution)

```sql
-- 여기에 작성한 쿼리를 붙여넣으세요.
SELECT ROUND((SUM(
	CASE WHEN credit ILIKE '%gift%' THEN 1
	ELSE 0
	END
)*100.0 / COUNT(*)),3)as ratio
FROM artworks
```

---
##  오답 노트 & 배운 점 (Retrospective)

-  **내가 실수한 부분:**
	- 처음에 전체 비율을 구해야 하는데 `artwork_id`로 `GROUP BY`를 해서 **여러 행이 나오게 만들**
	- `WHERE credit ILIKE '%gift%'`를 쓰면 분모가 줄어들어 **전체 대비 비율을 계산할 수 없다는 점을 놓쳤다**
    
-  **새로 알게 된 함수/꿀팁:**
	- 비율 계산은 `WHERE` 대신 **조건부 집계 (`SUM(CASE WHEN ... THEN 1 ELSE 0 END)`)** 로 처리

---
## 더 나은 풀이가 있다면?

```sql
-- 더 나은 풀이가 있을경우 
SELECT
  ROUND(
    COUNT(*) FILTER (WHERE credit ILIKE '%gift%') * 100.0 / COUNT(*),
    3
  ) AS ratio
FROM artworks;
```

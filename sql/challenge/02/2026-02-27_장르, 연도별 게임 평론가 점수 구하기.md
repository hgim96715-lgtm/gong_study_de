---
tags:
  - SQL_TEST
related:
  - "[[00_SQL_Challenge_DashBoard]]"
  - "[[SQL_Aggregate_GROUP_BY]]"
  - "[[SQL_Filtering_WHERE]]"
source: solvesql
difficulty:
  - Lv.3
status: ğŸŸ© í•´ê²°
---
##  í•´ê²° ì „ëµ (Code Before Think)

> ì¥ë¥´ ê²°ì •ì— ì°¸ê³ í•˜ê¸° ìœ„í•´ ì¶œì‹œ ì—°ë„ ê¸°ì¤€ 2011ë…„ë¶€í„° 2015ë…„ê¹Œì§€ ê° ì¥ë¥´ì˜ í‰ë¡ ê°€ ì ìˆ˜ í‰ê· ì„ ê³„ì‚°í•˜ê³ ì í•©ë‹ˆë‹¤. ì•„ë˜ ê²°ê³¼ í…Œì´ë¸” ì˜ˆì‹œì™€ ê°™ì´ í‰ë¡ ê°€ ì ìˆ˜ í‰ê· ì„ ê³„ì‚°í•˜ëŠ” ì¿¼ë¦¬ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”. í‰ë¡ ê°€ ì ìˆ˜ í‰ê· ì€ ì¶œì‹œ ì—°ë„, ì¥ë¥´ë¡œ ë¬¶ì¸ ê²Œì„ë“¤ì˜ í‰ë¡ ê°€ í‰ê·  ì ìˆ˜ë“¤ì˜ í‰ê· ì´ë©°, í‰ë¡ ê°€ ì ìˆ˜ê°€ ì—†ëŠ” ê²Œì„ì€ ì¥ë¥´ í‰ë¡ ê°€ ì ìˆ˜ í‰ê·  ê³„ì‚°ì—ì„œ ì œì™¸ë˜ì–´ì•¼ í•©ë‹ˆë‹¤. ëª¨ë“  í‰ê·  ì ìˆ˜ëŠ” ì†Œìˆ˜ì  ì•„ë˜ ì…‹ì§¸ ìë¦¬ì—ì„œ ë°˜ì˜¬ë¦¼ í•´, ë‘˜ì§¸ ìë¦¬ê¹Œì§€ ì¶œë ¥ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.

1. **íƒ€ê²Ÿ ë°ì´í„°:** (ì–´ë–¤ í…Œì´ë¸”ì—ì„œ ë¬´ì—‡ì„ ë½‘ì•„ì•¼ í•˜ëŠ”ê°€?)
   - `genres` í…Œì´ë¸”
	   - `genre_id` ì¥ë¥´ ID
	   - `Â name` ì¥ë¥´ ì´ë¦„
- `games` í…Œì´ë¸”
	- `genre_id` ì¥ë¥´ ID
	- `year` ì¶œì‹œì—°ë„
	- `Â critic_score` í‰ë¡ ê°€ í‰ê· ì ìˆ˜
1. **ì¡°ê±´ ë¶„ì„:**
   - ì¶œì‹œ ì—°ë„ ê¸°ì¤€ **2011ë…„ë¶€í„° 2015ë…„ê¹Œì§€**
   - í‰ê·  ì ìˆ˜ëŠ” **ì†Œìˆ˜ì  ì…‹ì§¸ ìë¦¬ì—ì„œ ë°˜ì˜¬ë¦¼í•˜ì—¬ ë‘˜ì§¸ ìë¦¬ê¹Œì§€** í‘œì‹œ
1. **ì‚¬ìš©í•  ë¬¸ë²•:**
   - JOIN
   - WHERE
   - CASE WHEN
   - ROUND
   - AVG
   - GROUP BY
---
## ì •ë‹µ ì¿¼ë¦¬ (Solution)

```sql
-- ì—¬ê¸°ì— ì‘ì„±í•œ ì¿¼ë¦¬ë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.
SELECT ge.name as genre,
ROUND(AVG(CASE WHEN ga.year = 2011 THEN ga.critic_score END),2) as score_2011,
ROUND(AVG(CASE WHEN ga.year = 2012 THEN ga.critic_score END),2) as score_2012,
ROUND(AVG(CASE WHEN ga.year = 2013 THEN ga.critic_score END),2) as score_2013,
ROUND(AVG(CASE WHEN ga.year = 2014 THEN ga.critic_score END),2) as score_2014,
ROUND(AVG(CASE WHEN ga.year = 2015 THEN ga.critic_score END),2) as score_2015
FROM genres ge
JOIN games ga ON ge.genre_id=ga.genre_id
WHERE ga.year BETWEEN 2011 AND 2015 and ga.critic_score IS NOT NULL
GROUP BY ge.name
ORDER BY ge.name
```

---
##  ì˜¤ë‹µ ë…¸íŠ¸ & ë°°ìš´ ì  (Retrospective)

-  **ë‚´ê°€ ì‹¤ìˆ˜í•œ ë¶€ë¶„:**
    
-  **ìƒˆë¡œ ì•Œê²Œ ëœ í•¨ìˆ˜/ê¿€íŒ:**
	- `AVG()` í•¨ìˆ˜ëŠ” **NULL ê°’ì„ ìë™ìœ¼ë¡œ ì œì™¸**í•˜ê³  í‰ê· ì„ ê³„ì‚°í•œë‹¤

---
## ë” ë‚˜ì€ í’€ì´ê°€ ìˆë‹¤ë©´?

>ì •ë¦¬í•´ë’€ë˜ FILTERì„ ì“°ë„ë¡ ë…¸ë ¥í•˜ì!!! [[SQL_CASE_WHEN#PostgreSQL ì „ìš© `FILTER` êµ¬ë¬¸|postgre-FILTER]] ì°¸ì¡°

```sql
-- ë” ë‚˜ì€ í’€ì´ê°€ ìˆì„ê²½ìš° 
SELECT
  ge.name AS genre,
  ROUND(AVG(ga.critic_score) FILTER (WHERE ga.year = 2011), 2) AS score_2011,
  ROUND(AVG(ga.critic_score) FILTER (WHERE ga.year = 2012), 2) AS score_2012,
  ROUND(AVG(ga.critic_score) FILTER (WHERE ga.year = 2013), 2) AS score_2013,
  ROUND(AVG(ga.critic_score) FILTER (WHERE ga.year = 2014), 2) AS score_2014,
  ROUND(AVG(ga.critic_score) FILTER (WHERE ga.year = 2015), 2) AS score_2015
FROM genres ge
JOIN games ga
  ON ge.genre_id = ga.genre_id
WHERE ga.year BETWEEN 2011 AND 2015
  AND ga.critic_score IS NOT NULL
GROUP BY ge.name
ORDER BY ge.name;
```

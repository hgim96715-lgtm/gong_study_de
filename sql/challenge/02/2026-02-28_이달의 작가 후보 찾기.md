---
tags:
  - SQL_TEST
related:
  - "[[00_SQL_Challenge_DashBoard]]"
  - "[[SQL_Aggregate_GROUP_BY]]"
  - "[[SQL_Filtering_WHERE]]"
  - "[[SQL_Window_Functions]]"
source: solvesql
difficulty:
  - Lv.3
status: 🟩 해결
---
##  해결 전략 (Code Before Think)

> 북클럽을 운영하는 당신은 화제성과 작품성을 모두 잡은 소설 작가를 찾아 이달의 작가로 선정하고 해당 작가의 작품들을 리뷰하는 시간을 가져보려고 합니다. 후보 작가 선정을 위해 당신은 아래와 같은 기준을 선정했습니다.
> 아마존 판매량 상위 50위 이내에 작품, 연도 상관 없이 2회 이상 등재
>  해당 작가 데이터의 평균 사용자 평점이 4.5점 이상
>  해당 작가 데이터의 평균 리뷰 수가 소설 분야 데이터의 평균 리뷰 수 이상
>  데이터베이스를 조회해 위 기준에 맞는 후보 작가 이름을 출력하는 쿼리를 작성해주세요. 쿼리 결과에는 작가 이름이 출력되는 컬럼 하나만 있어야 하고, 작가 이름 기준 사전순으로 정렬되어 있어야 합니다.

1. **타겟 데이터:** (어떤 테이블에서 무엇을 뽑아야 하는가?)
   - `books` 테이블
	   - ` author` 작가
	   - `user_rating` 아마존 고객 평균 평점
	   - `reviews` 아마존 리뷰 수
	   - ` genre`  장르 (Fiction/Non-Fiction)
1. **조건 분석:**
   - 
3. **사용할 문법:**
   - 
---
## 정답 쿼리 (Solution)

```sql
-- 여기에 작성한 쿼리를 붙여넣으세요.
WITH avg_review AS(
  SELECT AVG(reviews) AS a_review
  FROM books
  WHERE genre = 'Fiction'
)
SELECT author
FROM books
WHERE genre = 'Fiction'
GROUP BY author
HAVING
  COUNT(*) >= 2
  AND AVG(reviews) >= (SELECT a_review FROM avg_review)
  AND AVG(user_rating) >= 4.5
ORDER BY author;
```

---
##  오답 노트 & 배운 점 (Retrospective)

-  **내가 실수한 부분:**
	- 처음에 `user_rating`을 개별 값으로만 인식
	- “아마존 고객 **평균** 평점”이라고 되어 있었는데,  이를 **작가 단위의 `AVG(user_rating)`**로 해석하지 못하고  
	- 처음에는 `WHERE user_rating >= 4.5`처럼 **행 단위 필터**로 처리했다.
	- “Top 50에 2회 이상 등재”라는 조건을 보고 처음에는 `COUNT(*)` 대신 `RANK()` 또는 윈도우 함수를 떠올렸다
-  **새로 알게 된 함수/꿀팁:**
	- 복잡한 분석 함수(`RANK`, `DENSE_RANK`)를 떠올리기 전에
	- 먼저 **GROUP BY + COUNT/AVG**로 해결 가능한지 점검해야 한다.

---
## 더 나은 풀이가 있다면?

```sql
-- 더 나은 풀이가 있을경우 
```

---
tags:
  - SQL_TEST
related:
  - "[[SQL_JOIN_Concept]]"
source: solvesql
difficulty:
  - Lv.2
status: 🟩 해결
---
##  해결 전략 (Code Before Think)

> 요일별로 가장 높은 금액의 결제 내역을 출력하는 쿼리를 작성해주세요.
> 쿼리 결과에는 `tips` 테이블에 있는 모든 컬럼이 포함되어야 합니다.

1. **타겟 데이터:** (어떤 테이블에서 무엇을 뽑아야 하는가?)
   - `tips` 테이블
   - `day` 요일 
   - ` total_bill` : 식사금액
1. **조건 분석:**
   - 요일별
   - 가장 높은 금액 
1. **사용할 문법:**
   - 
---
## 정답 쿼리 (Solution)

```sql
-- 여기에 작성한 쿼리를 붙여넣으세요.
WITH top_bill AS(
SELECT total_bill,day,
RANK() OVER(PARTITION BY day ORDER BY total_bill DESC) as tb_ran
FROM tips
)

SELECT t.*
FROM tips t
JOIN top_bill tb ON t.day=tb.day and t.total_bill=tb.total_bill
WHERE tb_ran=1
```

---
##  오답 노트 & 배운 점 (Retrospective)

-  **내가 실수한 부분:**
	- 처음에는 `day` 컬럼만으로 `tips` 테이블과 CTE(`top_bill`)를 JOIN함
	- 요일만 같은 **최대 금액이 아닌 결제 내역까지 함께 조회될 수 있는 구조**였음
	- JOIN 조건에 `total_bill`을 추가하였다.    
-  **새로 알게 된 함수/꿀팁:**

---
## 더 나은 풀이가 있다면?

```sql
-- 더 나은 풀이가 있을경우 
SELECT t.*
FROM tips t
JOIN (
  SELECT day, MAX(total_bill) AS max_bill
  FROM tips
  GROUP BY day
) m
  ON t.day = m.day
 AND t.total_bill = m.max_bill;

```

>“그룹별 최대값 문제에서 **‘최대값’을 먼저 정의하고 그 값과 JOIN하는 방식도 있다 

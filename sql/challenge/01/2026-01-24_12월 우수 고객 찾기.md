---
aliases: []
tags:
  - SQL_TEST
related:
  - "[[SQL_Main_Table_Strategy]]"
  - "[[Aggregation_GROUP_BY]]"
  - "[[HAVING_vs_WHERE]]"
source:
  - solvesql
difficulty:
  - Lv.2
status: ðŸŸ¨ ížŒíŠ¸ì°¸ê³ 
---
##  í•´ê²° ì „ëžµ (Code Before Think)

> Â 2020ë…„ 12ì›” ë™ì•ˆ ìžˆì—ˆë˜ ëª¨ë“  ì£¼ë¬¸ì˜ ë§¤ì¶œ í•©ê³„ê°€ 1000$ ì´ìƒì¸ ê³ ê° IDë¥¼ ì¶œë ¥í•˜ëŠ” ì¿¼ë¦¬ë¥¼ ìž‘ì„±í•´ì£¼ì„¸ìš”.
> Â ì¿¼ë¦¬ ê²°ê³¼ì—ëŠ” ê³ ê° IDê°€ ë“¤ì–´ìžˆëŠ” ì»¬ëŸ¼ í•˜ë‚˜ë§Œ ìžˆì–´ì•¼ í•©ë‹ˆë‹¤.

1. **íƒ€ê²Ÿ ë°ì´í„°:** (ì–´ë–¤ í…Œì´ë¸”ì—ì„œ ë¬´ì—‡ì„ ë½‘ì•„ì•¼ í•˜ëŠ”ê°€?)
   - customer_id,order_date-> records
   - ê³ ê°ì˜ id -> customer_stats
1. **ì¡°ê±´ ë¶„ì„:**
   - 2020ë…„ 12ì›” ë™ì•ˆ 
   - ëª¨ë“  ì£¼ë¬¸ì˜ ë§¤ì¶œ í•©ê³„
1. **ì‚¬ìš©í•  ë¬¸ë²•:**
   - WHERE
   - GROUP
---
## ì •ë‹µ ì¿¼ë¦¬ (Solution)

```sql
-- ì—¬ê¸°ì— ìž‘ì„±í•œ ì¿¼ë¦¬ë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.
WITH customer_win AS(
SELECT SUM(sales),customer_id
FROM records
WHERE order_date >='2020-12-01' AND order_date<'2021-01-01'
GROUP BY customer_id
HAVING SUM(sales)>=1000
)

SELECT cs.customer_id
FROM customer_stats as cs
JOIN customer_win cw ON cs.customer_id=cw.customer_id
```

---
##  ì˜¤ë‹µ ë…¸íŠ¸ & ë°°ìš´ ì  (Retrospective)

-  **ë‚´ê°€ ì‹¤ìˆ˜í•œ ë¶€ë¶„(í—·ê°ˆë¦¬ëŠ” ë¶€ë¶„):**
sqlì„ êµ¬ìƒí• ë•Œ ì–´ë–¤ í…Œì´ë¸”ì„ ê¸°ì¤€ìœ¼ë¡œ ìž‘ì„±ì„ í•´ë‚˜ê°€ì•¼ í•˜ëŠ”ì§€ í—·ê°ˆë¦°ë‹¤
records â†’ ê³ ê°ì„ ë§Œë“¤ì–´ëƒ„ (ì§‘ê³„)
customer_stats â†’ ê³ ê° ì •ë³´ ë³´ì¡°

-  **ìƒˆë¡œ ì•Œê²Œ ëœ í•¨ìˆ˜/ê¿€íŒ:**

---
## ë” ë‚˜ì€ í’€ì´ê°€ ìžˆë‹¤ë©´?

- ë¬¸ì œì—ì„œ ìš”êµ¬í•œê²Œ customer_id ì»¬ëŸ¼ í•˜ë‚˜ë¼ì„œ join ì´ í•„ìš” ì—†ìŒ

```sql
-- ë” ë‚˜ì€ í’€ì´ê°€ ìžˆì„ê²½ìš° 
SELECT customer_id
FROM records
WHERE order_date >= '2020-12-01'
  AND order_date < '2021-01-01'
GROUP BY customer_id
HAVING SUM(sales) >= 1000;
```

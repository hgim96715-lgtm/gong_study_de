---
aliases: []
tags:
  - SQL_TEST
related:
  - "[[Aggregation_GROUP_BY]]"
  - "[[SQL_JOIN_Concept]]"
source: solvesql
difficulty:
  - Lv.2
status: 🟨 힌트참고
---
##  해결 전략 (Code Before Think)

> 우수 고객은 현재 대여점의 유효 고객 중 대여 횟수가 35회 이상인 고객
> 데이터베이스를 조회해 프로모션 대상 우수 고객들의 고객 ID를 조회하는 쿼리를 작성해주세요
> 쿼리 결과에는 아래 컬럼이 있어야 합니다. - `customer_id`: 프로모션 대상 우수 고객의 ID

1. **타겟 데이터:** (어떤 테이블에서 무엇을 뽑아야 하는가?)
   - customer 테이블
	   - `customer_id` : 고객 식별자
	   - `active` : 유효 고객 여부 판단에 사용
- rental 테이블
	- `customer_id` : 어떤 고객의 대여인지 식별
	- `rental_id` : 대여 1건을 의미 (대여 횟수 계산 기준)
1. **조건 분석:**
   -  customer.active = true, 횟수 COUNT 
1. **사용할 문법:**
   - WHERE 
   - JOIN
   - SUM 
   - GROUP BY
---
## 정답 쿼리 (Solution)

```sql
-- 여기에 작성한 쿼리를 붙여넣으세요.
WITH rental_cnt AS(
SELECT COUNT(rental_id),customer_id
FROM rental
GROUP BY customer_id
HAVING COUNT(rental_id)>=35
)

SELECT c.customer_id
FROM customer c
JOIN rental_cnt r ON c.customer_id=r.customer_id
WHERE c.active=true
```

---
##  오답 노트 & 배운 점 (Retrospective)

-  **내가 실수한 부분:** 
1. 대여 횟수 계산에 `SUM(customer_id)`를 사용함
	- `customer_id`는 단순 식별자(ID)인데, 이를 더해서 횟수를 계산하려고 함
	- “몇 번 대여했는가?”는 **값의 합이 아니라 행의 개수**라는 개념을 놓침
2. 집계 대상 컬럼을 명확히 생각하지 못함
	- `rental` 테이블에는 이미 각 대여를 식별하는 `rental_id`가 있음
	- 이 컬럼을 기준으로 세면 대여 횟수를 정확히 계산할 수 있었음
3. 집계 함수 선택 기준을 혼동함
	- `SUM`은 **금액, 수량, 점수처럼 누적 가능한 값**에 쓰는 함수
	- 횟수 계산에는 적절하지 않음

-  **새로 알게 된 함수/꿀팁:**
1. 횟수 계산은 `COUNT()`
	- `COUNT(*)` : 해당 그룹의 전체 행 수
	- `COUNT(rental_id)` : `NULL`이 아닌 대여 건수
	- → “몇 번 발생했는가?”를 묻는 문제는 거의 항상 `COUNT`

---
## 더 나은 풀이가 있다면?

```sql
-- 더 나은 풀이가 있을경우 
```

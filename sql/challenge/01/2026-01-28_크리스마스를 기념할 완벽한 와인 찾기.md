---
aliases: []
tags:
  - SQL_TEST
related:
  - "[[SubQuery_CTE]]"
source: solvesql
difficulty:
  - Lv.3
status: 🟨 힌트참고
---
##  해결 전략 (Code Before Think)

> 1. 화이트 와인일 것
> 2. 와인 품질 점수가 7점 이상일 것
> 3. 밀도와 잔여 설탕이 와인 전체의 해당 성분 평균 보다 높을 것
> 4. 산도가 화이트 와인 전체 평균보다 낮고, 구연산 값이 화이트 와인 전체 평균 보다 높을 것
> 위의 조건에 맞는 와인 목록을 추린 뒤 그 중 하나의 와인을 친구에게 선물하려고 합니다
> 조건에 맞는 와인 목록을 출력하는 쿼리를 작성해주세요. 
> 쿼리 결과에는 `wines` 테이블에 있는 모든 컬럼이 출력되어야 합니다.

3. **타겟 데이터:** (어떤 테이블에서 무엇을 뽑아야 하는가?)
   - wines 테이블
3. **조건 분석:**
   - color groupby
   - 품질점수 7점이상 where
   - 화이트 와인 where
3. **사용할 문법:**
   - 
---
## 정답 쿼리 (Solution)

```sql
-- 여기에 작성한 쿼리를 붙여넣으세요.
SELECT *
FROM wines
WHERE color = 'white'
AND quality >= 7
AND density > (SELECT AVG(density) FROM wines)
AND residual_sugar > (SELECT AVG(residual_sugar) FROM wines)
AND pH < (SELECT AVG(pH) FROM wines WHERE color = 'white')
AND citric_acid > (SELECT AVG(citric_acid) FROM wines WHERE color = 'white')
```

---
##  오답 노트 & 배운 점 (Retrospective)

-  **내가 실수한 부분:**
	- 처음에는 **JOIN으로 평균값 계산** 후 조건 비교를 시도했다. , `JOIN avg_wine aw ON w.color=aw.color`
	- 이렇게 하면 **밀도(density)와 잔여 설탕(residual_sugar)의 전체 평균**과 **산도(pH)와 구연산(citric_acid)의 화이트 평균**을 동시에 비교할 수 없었다
	- 쿼리가 문제 조건을 완전히 만족하지 못하고 **37개 출력** → 정답은 **30개**.

-  **새로 알게 된 함수/꿀팁:**
	- SQL에서는 **평균 기준이 달라지면 JOIN보다 서브쿼리가 더 직관적일 때가 많다**는 것을 체감했다
	- 무조건 CTE가 좋은 것은 아니라는 것을 알게 되었다.
	- 서브쿼리를 사용하면 CTE 없이도 원하는 평균값을 바로 조건에 넣을 수 있음
	- CTE는 코드 가독성을 위해 좋지만, **평균 기준이 서로 다른 조건**에서는 오히려 **서브쿼리가 더 단순하고 안전**할 수 있음.
	- 단순히 “전체 평균값 하나” 또는 “화이트 평균값 하나”와 비교하는 문제라서,JOIN 필요없음, GROUP BY 필요 없음, 서브 쿼리만 있으면 충분 

---
## 더 나은 풀이가 있다면?

```sql
-- 더 나은 풀이가 있을경우 
```
